<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Role Debug - FinTrackr</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4F46E5;
            padding-bottom: 10px;
        }
        .info-box {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
        }
        .label {
            font-weight: bold;
            color: #4F46E5;
            margin-bottom: 5px;
        }
        .value {
            background: #fff;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
            margin-top: 5px;
            word-break: break-all;
        }
        .success {
            color: #10B981;
            font-weight: bold;
        }
        .error {
            color: #EF4444;
            font-weight: bold;
        }
        .warning {
            color: #F59E0B;
            font-weight: bold;
        }
        button {
            background: #4F46E5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #4338CA;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç User Role Debug Tool</h1>
        
        <div class="info-box">
            <div class="label">Login Status:</div>
            <div class="value" id="loginStatus">Checking...</div>
        </div>

        <div class="info-box">
            <div class="label">User Data:</div>
            <div class="value" id="userData">Loading...</div>
        </div>

        <div class="info-box">
            <div class="label">User Role (Raw):</div>
            <div class="value" id="userRole">Loading...</div>
        </div>

        <div class="info-box">
            <div class="label">Role Type:</div>
            <div class="value" id="roleType">Loading...</div>
        </div>

        <div class="info-box">
            <div class="label">Is Admin Check:</div>
            <div class="value" id="isAdmin">Loading...</div>
        </div>

        <div class="info-box">
            <div class="label">JWT Token Present:</div>
            <div class="value" id="tokenStatus">Loading...</div>
        </div>

        <div style="margin-top: 20px;">
            <button onclick="location.reload()">üîÑ Refresh</button>
            <button onclick="window.location.href='dashboard.html'">üìä Go to Dashboard</button>
            <button onclick="window.location.href='index.html'">üè† Go to Login</button>
            <button onclick="clearSession()">üóëÔ∏è Clear Session</button>
        </div>
    </div>

    <script>
        function clearSession() {
            if (confirm('Clear all session data?')) {
                sessionStorage.clear();
                alert('Session cleared!');
                location.reload();
            }
        }

        // Check user data
        const userData = sessionStorage.getItem('fintrackr_user');
        const token = sessionStorage.getItem('fintrackr_token');

        // Login status
        const loginStatusEl = document.getElementById('loginStatus');
        if (userData && token) {
            loginStatusEl.innerHTML = '<span class="success">‚úÖ Logged In</span>';
        } else if (userData && !token) {
            loginStatusEl.innerHTML = '<span class="warning">‚ö†Ô∏è User data present but no token</span>';
        } else {
            loginStatusEl.innerHTML = '<span class="error">‚ùå Not Logged In</span>';
        }

        // User data
        const userDataEl = document.getElementById('userData');
        if (userData) {
            try {
                const user = JSON.parse(userData);
                userDataEl.textContent = JSON.stringify(user, null, 2);
            } catch (e) {
                userDataEl.innerHTML = '<span class="error">Error parsing user data: ' + e.message + '</span>';
            }
        } else {
            userDataEl.innerHTML = '<span class="error">No user data in sessionStorage</span>';
        }

        // Role
        const userRoleEl = document.getElementById('userRole');
        const roleTypeEl = document.getElementById('roleType');
        const isAdminEl = document.getElementById('isAdmin');
        
        if (userData) {
            try {
                const user = JSON.parse(userData);
                
                // Raw role
                userRoleEl.textContent = user.role || '(undefined)';
                
                // Role type
                roleTypeEl.textContent = typeof user.role;
                
                // Is admin check
                const roleStr = String(user.role || '').toUpperCase();
                const isAdmin = roleStr === 'ROLE_ADMIN' || roleStr === 'ADMIN' || user.isAdmin === true;
                
                if (isAdmin) {
                    isAdminEl.innerHTML = '<span class="success">‚úÖ YES - User has admin role</span>';
                    isAdminEl.innerHTML += '<br><br>Expected behavior: "Switch to Admin" link should be VISIBLE';
                } else {
                    isAdminEl.innerHTML = '<span class="error">‚ùå NO - User is not admin</span>';
                    isAdminEl.innerHTML += '<br><br>Expected behavior: "Switch to Admin" link should be HIDDEN';
                    isAdminEl.innerHTML += '<br><br>Current role: ' + user.role;
                    isAdminEl.innerHTML += '<br>To see admin link, login with:<br>Username: admin<br>Password: admin123';
                }
            } catch (e) {
                userRoleEl.innerHTML = '<span class="error">Error: ' + e.message + '</span>';
                roleTypeEl.textContent = 'N/A';
                isAdminEl.textContent = 'N/A';
            }
        } else {
            userRoleEl.textContent = 'No user data';
            roleTypeEl.textContent = 'N/A';
            isAdminEl.innerHTML = '<span class="error">Not logged in</span>';
        }

        // Token
        const tokenStatusEl = document.getElementById('tokenStatus');
        if (token) {
            tokenStatusEl.innerHTML = '<span class="success">‚úÖ Token present (' + token.substring(0, 20) + '...)</span>';
        } else {
            tokenStatusEl.innerHTML = '<span class="error">‚ùå No token found</span>';
        }

        // Console output
        console.log('=== Role Debug Info ===');
        console.log('User Data:', userData);
        console.log('Parsed User:', userData ? JSON.parse(userData) : null);
        console.log('Token Present:', !!token);
    </script>
</body>
</html>
